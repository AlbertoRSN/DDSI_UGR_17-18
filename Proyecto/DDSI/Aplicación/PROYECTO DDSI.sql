CREATE TABLE Rutero(
    NRPRutero NUMBER(5) GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY ,
    DNI varchar2(9) NOT NULL,
    Nombre varchar2(20) NOT NULL,
    Apellido varchar2(20) NOT NULL
);

CREATE TABLE Ruta(
    Codruta NUMBER(5) GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY
);

CREATE TABLE Maneja(
    Codruta NUMBER(5) PRIMARY KEY REFERENCES Ruta (Codruta),
    NRPRutero NUMBER(5) REFERENCES Rutero (NRPRutero)
);     
    
CREATE TABLE Paquete(
    Codpaquete NUMBER(5) GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    Peso NUMBER(4) NOT NULL,
    DirEnvio varchar2(30) NOT NULL,
    DirEmisor varchar2(30) NOT NULL,
    Bultos NUMBER(4) NOT NULL
);  

CREATE TABLE Enruta(
    Codpaquete NUMBER(5) PRIMARY KEY REFERENCES Paquete (Codpaquete),
    Codruta NUMBER(5) REFERENCES Ruta (Codruta)
);    
      

CREATE TABLE AlbaranGenera(
    CodAlbaran NUMBER(8) GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    CodPaquete NUMBER(5) REFERENCES Enruta (CodPaquete),
    Precio NUMBER(4)    
);

CREATE TABLE Aceptado(
    CodAlbaran NUMBER(8) PRIMARY KEY REFERENCES AlbaranGenera (CodAlbaran)
);

CREATE TABLE Rechazado(
CodAlbaran NUMBER(8) PRIMARY KEY REFERENCES AlbaranGenera (CodAlbaran)
);

CREATE TABLE Pagado(
CodAlbaran NUMBER(8) PRIMARY KEY REFERENCES AlbaranGenera (CodAlbaran)
);

CREATE TABLE ProduceFactura(
    CodFactura NUMBER(5) GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    CodAlbaran NUMBER(8) REFERENCES Pagado (CodAlbaran)
);

create or replace TRIGGER TRIGGER1 
AFTER INSERT ON ENRUTA 
FOR EACH ROW
DECLARE
p NUMBER(10);
b NUMBER(10);
precio NUMBER(10);
BEGIN
    SELECT PESO INTO p FROM PAQUETE WHERE CODPAQUETE=:new.CODPAQUETE;
    SELECT BULTOS INTO b FROM PAQUETE WHERE CODPAQUETE=:new.CODPAQUETE;
    precio:=p*b;
    INSERT INTO ALBARANGENERA VALUES (NULL,:new.CODPAQUETE,precio);
END;

create or replace TRIGGER TRIGGER2 
AFTER INSERT ON PAGADO 
FOR EACH ROW
DECLARE
p NUMBER(10);
b NUMBER(10);
precio NUMBER(10);
BEGIN
    INSERT INTO PRODUCEFACTURA VALUES (NULL,:new.CODALBARAN);
END;

create or replace TRIGGER TRIGGER3
BEFORE INSERT ON MANEJA 
FOR EACH ROW
DECLARE
p VARCHAR(10);
BEGIN
    SELECT NRPRUTERO INTO p FROM MANEJA WHERE NRPRUTERO=:new.NRPRUTERO;
         IF p = 1 THEN
         raise_application_error(-20501,'No se puede agregar la ruta porque el rutero ya esta asignado');
        END IF;
   exception
   when no_data_found then
   dbms_output.put_line('No se ha encontrado ning√∫n rutero');
END;

create or replace TRIGGER TRIGGER4
AFTER INSERT ON PAGADO 
FOR EACH ROW
BEGIN
    INSERT INTO ACEPTADO VALUES (:new.CODALBARAN);
END;


INSERT INTO RUTERO VALUES(NULL,'G23796394','ARTURO','ESPARZA');
INSERT INTO RUTA VALUES(NULL);
INSERT INTO MANEJA VALUES(1,1);
INSERT INTO PAQUETE VALUES(NULL,10,'MIRADOR DE ROLANDO','MARTINETES',3);
INSERT INTO ENRUTA VALUES(1,1);
INSERT INTO PAGADO VALUES(1);
INSERT INTO RUTERO VALUES(NULL,12345,'JAVIER','GALERA');
INSERT INTO RUTA VALUES(NULL);
INSERT INTO MANEJA VALUES(2,2);
INSERT INTO PAQUETE VALUES(NULL,5,'ALTA DE CARTUJA','MARTINETES',2);
INSERT INTO ENRUTA VALUES(1,2);
INSERT INTO PAGADO VALUES(2);





